<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Help - Simple Geomancy</title>
    <link rel="stylesheet" href="common.css">
    <script>
        // FOUC防止: DOMが構築される前にテーマを適用
        (function() {
            try {
                const savedTheme = localStorage.getItem('simplegeomancy-theme') || 'system';
                const html = document.documentElement;

                if (savedTheme === 'dark') {
                    html.setAttribute('data-theme', 'dark');
                } else if (savedTheme === 'system') {
                    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                        html.setAttribute('data-theme', 'dark');
                    }
                }
            } catch (e) {
                console.error('Failed to apply initial theme:', e);
            }
        })();
    </script>
    <style>
        :root {
            --text-secondary: #555555;
        }

        [data-theme="dark"] {
            --text-secondary: #b0b0b0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Noto Sans JP', sans-serif;
            background: var(--body-bg);
            color: var(--dialog-text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .header {
            background: var(--header-bg);
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            flex-shrink: 0;
            transition: background-color 0.3s ease;
        }

        .close-btn {
            font-size: 28px;
            color: var(--header-text);
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
            transition: color 0.3s ease;
        }

        .content {
            flex: 1;
            padding: 24px 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .section {
            margin-bottom: 32px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dialog-text);
            margin-bottom: 12px;
            transition: color 0.3s ease;
        }

        .section-text {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.8;
            transition: color 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="close-btn" onclick="goBack()">×</button>
        <div></div>
    </div>

    <div class="content">
        <div class="section">
            <div class="section-title" id="title1">ジオマンシーとは</div>
            <div class="section-text" id="text1">
                古代から伝わる土占い。16のシンボルを使います。シンプルでありながら、具体的で明快なメッセージを受け取ることができます。
            </div>
        </div>

        <div class="section">
            <div class="section-title" id="title2">このアプリについて</div>
            <div class="section-text" id="text2">
                このアプリでは、ドットを打つという伝統的なやり方で、簡単にジオマンシーで占うことができます。チャート表示画面の右上にあるシェアボタンから、結果を画像としてSNSにシェアしたり、保存したりすることができます。なお、各シンボルやチャートの意味・解釈については、このアプリには含まれていません。それぞれのシンボルが持つメッセージを、ご自身で調べながら読み解いてください。
            </div>
        </div>

        <div class="section">
            <div class="section-title" id="title3">シールドチャート・ハウスチャート</div>
            <div class="section-text" id="text3">
                伝統的な占い方です。どんなことを占いたいのかを強く心に思いながら、4つの領域を右から左に向かってタップしていき、思いのままにドットを打ってください。4つすべてにドットが打たれたら右上の「OK」ボタンを押してください。ドットの個数（偶数・奇数）に応じてジオマンシーのシンボルが決まります。これを4回繰り返すと4つのシンボルが決まり、シールドチャートとハウスチャートが表示されます。
            </div>
        </div>

        <div class="section">
            <div class="section-title" id="title4">シンプル・トリプシティ</div>
            <div class="section-text" id="text4">
                シールドチャート・ハウスチャートと同じ方法でドットを打ち、シンボルを2つ生成します。この2つのシンボルから、よりシンプルに占うことができます。どんなことを占いたいのかを強く心に思いながら、4つの領域を右から左に向かってタップしていき、思いのままにドットを打ってください。これを2回繰り返すと、シンプル・トリプシティのチャートが表示されます。
            </div>
        </div>

        <div class="section">
            <div class="section-title" id="title5">ワンオラクル</div>
            <div class="section-text" id="text5">
                ワンオラクルは最も基本的な占い方で、ただ一つのシンボルから答えを導き出します。画面下のボタンを4回長押しするとすぐにシンボルが1つ決まります。シンプルで直感的な答えを求めるときに最適です。
            </div>
        </div>
    </div>

    <script>
        // 言語設定のストレージキー
        const LANGUAGE_STORAGE_KEY = 'simplegeomancy-language';
        const THEME_STORAGE_KEY = 'simplegeomancy-theme';

        // 言語ごとのテキスト定義
        const translations = {
            en: {
                title1: 'What is Geomancy',
                text1: 'Geomancy is an ancient form of divination using 16 figures. Simple yet powerful, it provides clear and concrete guidance.',
                title2: 'About This App',
                text2: 'This app lets you practice geomancy using the traditional dot-marking method. Use the share button (top right) to save or share your chart results. Note: This app focuses on generating charts—interpretations and meanings are not included. We encourage you to explore and interpret the figures yourself.',
                title3: 'Shield Chart & House Chart',
                text3: 'The traditional method of geomancy. Focus on your question while tapping freely across the four areas from right to left. Once all four areas have dots, tap "OK" (top right). The figures are determined by whether you marked an odd or even number of dots. Repeat this four times to create four figures, which will then generate your Shield Chart and House Chart.',
                title4: 'Simple Three-Figure Reading',
                text4: 'A simplified method that generates just two figures using the same dot-marking process. Focus on your question while tapping freely across the four areas from right to left. Repeat this twice to create your three-figure reading.',
                title5: 'Single Figure Reading',
                text5: 'The simplest form of divination—one figure, one answer. Press and hold the button four times to quickly generate a single figure. Perfect when you need quick, intuitive guidance.'
            },
            fr: {
                title1: 'Qu\'est-ce que la Géomancie',
                text1: 'La géomancie est une forme ancienne de divination utilisant 16 figures. Simple mais puissante, elle offre des messages clairs et concrets.',
                title2: 'À propos de cette application',
                text2: 'Cette application vous permet de pratiquer la géomancie en utilisant la méthode traditionnelle de marquage de points. Utilisez le bouton de partage (en haut à droite) pour enregistrer ou partager vos résultats. Note : Cette application se concentre sur la génération de tableaux—les interprétations ne sont pas incluses. Nous vous encourageons à explorer et interpréter les figures vous-même.',
                title3: 'Écu et Maisons géomantiques',
                text3: 'La méthode traditionnelle de géomancie. Concentrez-vous sur votre question en tapotant librement dans les quatre zones de droite à gauche. Une fois que toutes les zones contiennent des points, appuyez sur "OK" (en haut à droite). Les figures sont déterminées selon que vous avez marqué un nombre pair ou impair de points. Répétez quatre fois pour créer quatre figures, qui généreront ensuite votre Écu et vos Maisons géomantiques.',
                title4: 'Lecture à Trois Figures',
                text4: 'Une méthode simplifiée qui génère seulement deux figures en utilisant le même processus de marquage. Concentrez-vous sur votre question en tapotant librement dans les quatre zones de droite à gauche. Répétez deux fois pour créer votre lecture à trois figures.',
                title5: 'Lecture à Une Figure',
                text5: 'La forme la plus simple de divination—une figure, une réponse. Appuyez longuement sur le bouton quatre fois pour générer rapidement une figure unique. Parfait lorsque vous avez besoin de conseils rapides et intuitifs.'
            },
            ja: {
                title1: 'ジオマンシーとは',
                text1: '古代から伝わる土占い。16のシンボルを使います。シンプルでありながら、具体的で明快なメッセージを受け取ることができます。',
                title2: 'このアプリについて',
                text2: 'このアプリでは、ドットを打つという伝統的なやり方で、簡単にジオマンシーで占うことができます。チャート表示画面の右上にあるシェアボタンから、結果を画像としてSNSにシェアしたり、保存したりすることができます。なお、各シンボルやチャートの意味・解釈については、このアプリには含まれていません。それぞれのシンボルが持つメッセージを、ご自身で調べながら読み解いてください。',
                title3: 'シールドチャート・ハウスチャート',
                text3: '伝統的な占い方です。どんなことを占いたいのかを強く心に思いながら、4つの領域を右から左に向かってタップしていき、思いのままにドットを打ってください。4つすべてにドットが打たれたら右上の「OK」ボタンを押してください。ドットの個数（偶数・奇数）に応じてジオマンシーのシンボルが決まります。これを4回繰り返すと4つのシンボルが決まり、シールドチャートとハウスチャートが表示されます。',
                title4: 'シンプル・トリプリシティ',
                text4: 'シールドチャート・ハウスチャートと同じ方法でドットを打ち、シンボルを2つ生成します。この2つのシンボルから、よりシンプルに占うことができます。どんなことを占いたいのかを強く心に思いながら、4つの領域を右から左に向かってタップしていき、思いのままにドットを打ってください。これを2回繰り返すと、シンプル・トリプリシティのチャートが表示されます。',
                title5: 'ワンオラクル',
                text5: 'ワンオラクルは最も基本的な占い方で、ただ一つのシンボルから答えを導き出します。画面下のボタンを4回長押しするとすぐにシンボルが1つ決まります。シンプルで直感的な答えを求めるときに最適です。'
            }
        };

        let currentLanguage = 'fr';
        
        // 言語設定を読み込む
        function loadLanguage() {
            try {
                const savedLanguage = localStorage.getItem(LANGUAGE_STORAGE_KEY);
                if (savedLanguage && translations[savedLanguage]) {
                    currentLanguage = savedLanguage;
                    document.documentElement.lang = savedLanguage;
                    updateUI();
                }
            } catch (e) {
                console.error('Failed to load language preference:', e);
            }
        }

        // UIのテキストを更新
        function updateUI() {
            const texts = translations[currentLanguage];
            
            document.getElementById('title1').textContent = texts.title1;
            document.getElementById('text1').textContent = texts.text1;
            document.getElementById('title2').textContent = texts.title2;
            document.getElementById('text2').textContent = texts.text2;
            document.getElementById('title3').textContent = texts.title3;
            document.getElementById('text3').textContent = texts.text3;
            document.getElementById('title4').textContent = texts.title4;
            document.getElementById('text4').textContent = texts.text4;
            document.getElementById('title5').textContent = texts.title5;
            document.getElementById('text5').textContent = texts.text5;
        }

        // テーマを適用する関数
        function applyTheme(theme) {
            const html = document.documentElement;

            if (theme === 'system') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                if (prefersDark) {
                    html.setAttribute('data-theme', 'dark');
                } else {
                    html.removeAttribute('data-theme');
                }
            } else if (theme === 'dark') {
                html.setAttribute('data-theme', 'dark');
            } else {
                html.removeAttribute('data-theme');
            }
        }

        // テーマ設定を読み込む
        function loadTheme() {
            try {
                const savedTheme = localStorage.getItem(THEME_STORAGE_KEY);
                if (savedTheme && (savedTheme === 'system' || savedTheme === 'light' || savedTheme === 'dark')) {
                    applyTheme(savedTheme);
                } else {
                    applyTheme('system');
                }
            } catch (e) {
                console.error('Failed to load theme preference:', e);
                applyTheme('system');
            }
        }

        function goBack() {
            window.location.href = 'index.html';
        }

        window.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadLanguage();
        });

        window.addEventListener('pageshow', (event) => {
            if (event.persisted) {
                loadTheme();
                loadLanguage();
            }
        });

        // システムのダークモード設定の変更を監視
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            try {
                const savedTheme = localStorage.getItem(THEME_STORAGE_KEY);
                if (!savedTheme || savedTheme === 'system') {
                    applyTheme('system');
                }
            } catch (e) {
                console.error('Failed to update theme:', e);
            }
        });
    </script>
    <script src="common.js"></script>
</body>
</html>
